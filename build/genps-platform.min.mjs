class n{implementsSignals=void 0;projectStandardVersion=void 0;pendingDownload=void 0;constructor(n,t={}){this.callbacks=t,this.iframe=n,window.addEventListener("message",(n=>{const t=n.data;if(t&&this.iframe.contentWindow===n.source&&("gps:b:init"===t.type&&t.implementsSignals&&(this.projectStandardVersion=t.v,this.implementsSignals=t.implementsSignals,"function"==typeof this.callbacks.onInit&&(this.callbacks.onInit(this.projectStandardVersion,this.implementsSignals),this.callbacks.onInit=void 0)),"gps:b:load-prog"===t.type&&"function"==typeof this.callbacks.onLoadingProgress&&this.callbacks.onLoadingProgress(t.p),"gps:b:load-compl"===t.type&&"function"==typeof this.callbacks.onLoadingComplete&&this.callbacks.onLoadingComplete(),"gps:b:capt-prev"===t.type&&"function"==typeof this.callbacks.onCapturePreview&&this.callbacks.onCapturePreview(),"gps:b:download"===t.type)){if(!this.pendingDownload)return;!function(n,t){const e=document.createElement("a");e.download=t,e.href=n,document.body.appendChild(e),e.click(),document.body.removeChild(e)}(t.dataUrl,`${this.pendingDownload.key}.${t.ext}`),"function"==typeof this.pendingDownload.callback&&this.pendingDownload.callback(),this.pendingDownload=void 0}}));const e=()=>{this.iframe.contentWindow.postMessage({type:"gps:f:init",v:"1.0.1"},"*")};this.iframe.addEventListener("load",e),e()}get downloadSignals(){return this.implementsSignals?.filter((n=>"gps:f:download"===n.type))}triggerDownload(n){return this.pendingDownload?Promise.reject("Only one active download is supported at a time"):new Promise((t=>{this.pendingDownload={key:n,callback:t},this.iframe.contentWindow.postMessage({type:"gps:f:download",key:n},"*")}))}}export{n as GenArtPlatform};
